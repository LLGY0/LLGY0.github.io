---
layout: post
title:  "虚拟机学习"
subtitle: '缝缝补补'
date: 2023-07-10
categories: Study
published: true
comments: true
music-id: 1341338793
tags: 
- Study
---

本页内容参考书籍《玩转虚拟机——基于VMware+Windows》

# 1 基础知识

## 1.1 虚拟机概念

如图3-1所示，虚拟机VM2和VM3连接到VMnet1交换机上，此时只要VM2和VM3计算机的IP地址设置成一个网段就能通信，虚拟机VMl和VM4连接到了不同的交换机，即便IP地址设置成一个网段也不能通信，连接到不同虚拟交换机的虚拟机之间是不能直接通信的。

![](/assets/img/virtualmachine/3_1.png)

VMnet0不用规划IP地址，该网络的地址要和物理网络的地址在一个网段。

VMware DHCP Service服务可以为连接至VMnet的计算机白动分配IP地址。这样给虚拟机安装了操作系统，不配置IP地址，虚拟机也能够自动获得IP地址。

VMware Bridge Protocol让物理网卡连接到虚拟交换机VMnet。

VMware NAT Service 在你的计算机上虚拟出一个路由器，虚拟接口E0连接VMnet作为该网络计算机的网关，计算机的物理网卡作为该路由器的外网接口，该服务实现VMnet到物理网络的地址转换。VMware NAT Service 服务只能为一个VMnet提供网络地址转换服务。

## 1.2 NAT

NAT即Network Address Translation（网络地址转换），是实现虚拟机上网的第二种方法。图3-78所示是使用了NAT技术后数据包的转发情况，A1计算机访问WebA资源，发送的数据包的目标地址是WebA源地址即A1的地址，经过路由器R1，数据包的源地址被R1的 公网地址替换，这样数据包的目标地址和源地址都是公网地址了，WebA发送返回的数据包的 目标地址是R1的地址，能够发送到R1路由器，R1路由器收到数据包，再把数据包的目标地址替换成Al计算机的发送到内网，这就是网络地址转换。 

![](/assets/img/virtualmachine/3_78.png)

NAT技术的优点：

1、节省公网IP地址：NAT技术让使用私网地址的内网计算机能够访问Internet，这样能够大大节省公网IP地址。

2、内网安全：使用私网地址的内网可以访问Internet，但是Internet中的计算机不能主 动访问内网计算机。

缺点：由于R1路由器在内网和公网之间转发数据包时修改数据包的源地址或目标地址， 因此会稍微影响速度。 

## 1.3 其他

文件系统的分类：NTFS（Windows），支持最大分区2TB，最大文件2TB；FAT16（Windows）,支持最大分区2GB,最大文件2GB；FAT32（Windows）,支持最大分区128GB，最大文件4GB。

公网地址：整个Internet中，计算机和服务器的IP地址要统一规划，全球唯一，这些地址就是公网地 所有的IP地址都由国际组织NIC(Network Information Center)负责统一分配，目前全世址。全世界共有3个这样的网络信息中心：InterNIC，负责美国及其他地区；ENIC，负责欧洲地区：APNIC，负责亚太地区。我国申请IP地址要通过APNIC，APNIC的总部设在日本东京大学。 申请时要考虑申请哪一类的IP地址，然后向国内的代理机构提出。

私网地址：除了公网IP地址，还保留了一些私网地址，这些私网地址在Internet中没有被使用，企业、学校或政府的内网可以使用，不需要向国际组织注册。Internet上没有私网地址，因此Internet上的路由器也没有必要知道这些网段如何转发数据包。大家可以看到任何单位或企业的网络都可以使用这些私网地址，因为他们不需要相互访问网络，所以IP地址网段重合也没有关系。

私有网段保留了以下网段：

A类地址中有10.0.0.0~10.255.255.255.一个A类网段。

B类地址中有172.16.0.0~172.31.255.255，16个B类网段。

C类地址中有192.168.0.0～192.168.255.0，256个C类网段。

# 2 操作

## 2.1 跳过内容

虚拟机软件的安装、虚拟机的构建、物理机与虚拟机之间的文件传输和共享（VMware Tool）、虚拟机快照、克隆虚拟机

## 2.2 虚拟机网络地址规划（物理机添加网卡连接VMnet4）

具体步骤：进入“虚拟网络编辑器”，单击“更改设置”，单击“添加网络”，添加一个虚拟网络（虚拟交换机）。之后进入“虚拟机设置”，“网络连接”处选择“自定义”，选择所需的网络。

## 2.3 虚拟机访问物理机

如图3-34所示，可以在物理机上添加一个网卡连接到VMnet4，VMware Network Adapter VMnct4的IP地址要设置成192.168.40.10，该IP地址一定要和VMnct4规划的网络地址在一个网段，虚拟机VM4的IP地址设置成192.168.40.20，这样VM4要想访问物理机，就要访问192.168.40.10，而不能访问物理网卡的地址10.7.10.212。 

![](/assets/img/virtualmachine/3_34.png)

具体步骤：物理机添加网卡连接VMnet4，之后设置VMnet4的IP和掩码。之后打开物理机“网络连接”，设置VMnet4的IPV4的IP和掩码。之后打开虚拟机“网络连接”，设置网卡的IP和掩码。

## 2.4 虚拟机访问物理网络

具体步骤：进入“虚拟网络编辑器”，选择VMnet转换成“桥接模式”。之后设置虚拟机的IP地址，IP地址所在网段需要和物理网络中计算机的IP地址在同一个网段，子网掩码（255.255.255.0）、网关和DNS也要和物理网络中的计算机一样。

## 2.5 虚拟机通过NAT访问物理网络

原理：把某个VMnet所处的网络当作内网，把物理机 所的网络当作公网，并把物理机当作NAT路由器，让内网的虚拟机使用物理机的IP地址访问物理网络，这些虚拟机都使用私网地址，这样一来即使和其他物理机中虚拟机的IP地址相 同也没有关系。 

![](/assets/img/virtualmachine/3_79.png)

具体步骤：进入“虚拟网络编辑器”，VMnet8调为NAT模式，单击“NAT设置”，记下网关IP（即虚拟路由器E0接口）。之后打开物理机“网络连接”，调VMnet8的IP（需要设置为与虚拟路由器E0接口同一网段下的IP，但不能相同，否则导致网关地址冲突。接着打开“虚拟机设置”，虚拟机连接到VMnet8。之后打开虚拟机“网络连接”，调本地连接IPV4的IP（与虚拟路由器E0接口同一网段）以及子网掩码以及默认网关（就是虚拟路由器E0接口），DNS设置为8.8.8.8与222.222.222.222。

## 2.6 端口映射

服务器对外提供服务通常使用TCP或UDP协议侦听客户端的请求，客户端使用该端口访问对应的服务。远程桌面协议（RDP）默认使用TCP的3389端口。Web服务使用的http协议默认使用TCP的80端口。 

![](/assets/img/virtualmachine/3_94.png)

具体步骤：进入“虚拟网络编辑器”，VMnet8调为NAT模式，单击“NAT设置”，单击“添加”，输入主机端口4000，选择TCP协议，输入虚拟机IP，制定虚拟机端口3389。接着打开“虚拟机设置”，虚拟机连接到VMnet8，选择“已连接”和“启动时连接”的复选框。设置虚拟机的IP、子网掩码、网关。打开虚拟机的“计算机-管理”，创建新用户。打开虚拟机的“远程桌面”的“允许...计算机连接”，单击“选择用户”，“添加”刚才创建的新用户。查看物理机的IP。物理网络上的计算机上启动“远程桌面连接”，输入物理机IP+冒号+端口（4000）。

## 2.7 网络实现虚拟机与物理机文件共享

具体步骤：打开“虚拟机设置”，虚拟机连接到VMnet8。设置虚拟机的IP、子网掩码、网关（网关与IP位于同一网段）。设置物理机的VMnet8的IP（与虚拟机的默认网关一致）。物理机在要共享的文件右键，点击“共享”和“特定用户”，设置权限。虚拟机“运行”（Win+R）中输入"\\网关"，输入用户名和密码。